<!-- General Chart-Component to load individual charts -->
<ChartComponent CanvasId="CarbChart" ChartConfig="@ChartConfig" />

@code {
    //Get Data from main component
    [CascadingParameter(Name = "CarbsPoints")]
    private List<ChartPoint>? CarbsPoints { get; set; } = new();

    private object? ChartConfig { get; set; }

    // Create Chart Config
    protected override void OnInitialized()
    {
        if (CarbsPoints is not null && CarbsPoints.Count > 0)
        {
            // Generate labels based on current time for each data point
            var labels = CarbsPoints.Select(cp => cp.Date.ToString("dd.MM")).ToList();
            var carbohydrates = CarbsPoints.Select(cp => cp.Value).ToList();
            var nutritionGoalCarbs = CarbsPoints.Select(cp => cp.NutritionGoal).ToList();

            ChartConfig = new
            {
                data = new
                {
                    labels = labels,
                    datasets = new object[]
                    {
                        new {
                            type = "bar",
                            label = "Kohlenhydrate",
                            data = carbohydrates,
                            backgroundColor = "rgba(78, 168, 222, 0.6)",
                        },
                        new {
                            type = "line",
                            label = "Kohlenhydrateziel",
                            data = nutritionGoalCarbs,
                            backgroundColor = "rgba(255, 0, 0, 0.6)",
                            borderColor = "rgba(255, 0, 0, 0.6)",
                            pointRadius = 0,
                        },
                    }
                },
                options = new
                {
                    responsive = true,
                    maintainAspectRatio = false,
                    animation = false,

                    plugins = new
                    {
                        legend = new
                        {
                            display = false,
                        },
                    },

                    scales = new
                    {
                        x = new
                        {
                            grid = new
                            {
                                display = true,
                            },
                        },
                        y = new
                        {
                            beginAtZero = true,
                            title = new
                            {
                                padding = 0,
                                display = true,
                            }
                        }
                    },

                    Interaction = new
                    {
                        mode = "index",
                        axis = "x",
                        intersect = false,
                    },

                    hover = new
                    {
                        mode = "index",
                        intersect = false,
                    }
                }
            };
        }
    }
}